import{q as J,r as a,j as e}from"./index-pa_thSCV.js";import{C as d,a as r}from"./CRow-C3S0_Vw6.js";import{C as q,a as W}from"./CCardBody-GxEf9Cn3.js";import{C as _}from"./CCardHeader-DlNUx34W.js";import{C as K}from"./CForm-NXa-OVrg.js";import{C as c}from"./CFormLabel-CMaJqg25.js";import{C as j}from"./CFormInput-DIoOgNae.js";import{C as m}from"./CFormTextarea-By3_EK4u.js";import{a as P}from"./index.esm-Dz0yT19O.js";import{C as Q,a as V,b as U,c as o,d as X,e as i}from"./CTable-5Z20koPP.js";import"./CFormControlWrapper-DllR3RVu.js";import"./CFormControlValidation-D9fpJgZl.js";const de=()=>{const x=J();a.useEffect(()=>{localStorage.getItem("token")||x("/login")},[x]);const[u,f]=a.useState(""),[C,p]=a.useState(""),[D,S]=a.useState(""),[w,v]=a.useState(""),[N,y]=a.useState(""),[T,b]=a.useState(""),[F,I]=a.useState(""),[$,E]=a.useState(""),[A,B]=a.useState([]),[g,k]=a.useState([]),[l,M]=a.useState(null),[O,z]=a.useState(!0);a.useEffect(()=>{(()=>{const s=localStorage.getItem("token");if(s){const n=JSON.parse(atob(s.split(".")[1]));M(n.id)}})()},[]),a.useEffect(()=>{l&&(async()=>{const s=localStorage.getItem("token");try{const h=await(await fetch("https://hospital-management-server-nu.vercel.app/api/patient",{method:"GET",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}})).json();B(h),z(!1)}catch(n){console.error("Error fetching patient data:",n)}})()},[l]);const G=t=>{const s=t.target.value;if(f(s),O)return;const n=A.find(h=>h.patientName.toLowerCase()===s.toLowerCase());p(n?n.admissionDate.split("T")[0]:"")};a.useEffect(()=>{S(new Date().toISOString().split("T")[0])},[]);const L=async t=>{t.preventDefault();try{const s=await fetch("https://hospital-management-server-nu.vercel.app/api/summary",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({patientName:u,admissionDate:C,dischargeDate:D,diagnosis:w,treatments:N,medications:T,followUp:F,notes:$,userId:l})});if(s.ok){const n=await s.json();k([...g,n])}else{const n=await s.json();alert(n.message||"Failed to save discharge summary.")}}catch(s){console.error("Error saving the discharge summary:",s),alert("Error saving the discharge summary.")}f(""),p(""),S(""),v(""),y(""),b(""),I(""),E("")};a.useEffect(()=>{l&&H()},[l]);const H=async()=>{try{const n=(await(await fetch("https://hospital-management-server-nu.vercel.app/api/summary",{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).json()).filter(h=>h.userId===l);k(n)}catch(t){console.error("Error fetching discharge summaries:",t)}},R=t=>{const s=window.open("","_blank");s.document.write(`
      <html>
        <head>
          <title>Discharge Summary</title>
        </head>
        <body>
          <h1>Discharge Summary</h1>
          <p><strong>Patient Name:</strong> ${t.patientName}</p>
          <p><strong>Admission Date:</strong> ${t.admissionDate}</p>
          <p><strong>Discharge Date:</strong> ${t.dischargeDate}</p>
          <p><strong>Diagnosis:</strong> ${t.diagnosis}</p>
          <p><strong>Treatments Given:</strong> ${t.treatments}</p>
          <p><strong>Medications:</strong> ${t.medications}</p>
          <p><strong>Follow-Up Instructions:</strong> ${t.followUp}</p>
          <p><strong>Notes:</strong> ${t.notes}</p>
        </body>
      </html>
    `),s.document.close(),s.print()};return e.jsx(d,{children:e.jsx(r,{xs:12,children:e.jsxs(q,{className:"mb-4",children:[e.jsx(_,{children:e.jsx("strong",{children:"Discharge Summary Management"})}),e.jsxs(W,{children:[e.jsxs(K,{onSubmit:L,children:[e.jsxs(d,{children:[e.jsxs(r,{md:4,children:[e.jsx(c,{htmlFor:"patientName",children:"Patient Name"}),e.jsx(j,{type:"text",id:"patientName",placeholder:"Full name",value:u,onChange:G})]}),e.jsxs(r,{md:4,children:[e.jsx(c,{htmlFor:"admissionDate",children:"Admission Date"}),e.jsx(j,{type:"date",id:"admissionDate",value:C,readOnly:!0})]}),e.jsxs(r,{md:4,children:[e.jsx(c,{htmlFor:"dischargeDate",children:"Discharge Date"}),e.jsx(j,{type:"date",id:"dischargeDate",value:D,readOnly:!0})]})]}),e.jsxs(d,{className:"mt-3",children:[e.jsxs(r,{md:6,children:[e.jsx(c,{htmlFor:"diagnosis",children:"Diagnosis"}),e.jsx(m,{id:"diagnosis",rows:"2",placeholder:"Diagnosis details",value:w,onChange:t=>v(t.target.value)})]}),e.jsxs(r,{md:6,children:[e.jsx(c,{htmlFor:"treatments",children:"Treatments Given"}),e.jsx(m,{id:"treatments",rows:"2",placeholder:"Treatments provided",value:N,onChange:t=>y(t.target.value)})]})]}),e.jsxs(d,{className:"mt-3",children:[e.jsxs(r,{md:6,children:[e.jsx(c,{htmlFor:"medications",children:"Medications"}),e.jsx(m,{id:"medications",rows:"2",placeholder:"Prescribed medications",value:T,onChange:t=>b(t.target.value)})]}),e.jsxs(r,{md:6,children:[e.jsx(c,{htmlFor:"followUp",children:"Follow-up Instructions"}),e.jsx(m,{id:"followUp",rows:"2",placeholder:"Instructions for follow-up",value:F,onChange:t=>I(t.target.value)})]})]}),e.jsx(d,{className:"mt-3",children:e.jsxs(r,{md:12,children:[e.jsx(c,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(m,{id:"notes",rows:"3",placeholder:"Any additional information",value:$,onChange:t=>E(t.target.value)})]})}),e.jsx(d,{className:"mt-4",children:e.jsx(r,{md:12,className:"text-center",children:e.jsx(P,{color:"primary",type:"submit",className:"w-25",children:"Save Summary"})})})]}),g.length>0&&e.jsxs(Q,{className:"mt-4",bordered:!0,children:[e.jsx(V,{children:e.jsxs(U,{children:[e.jsx(o,{children:"Patient Name"}),e.jsx(o,{children:"Admission Date"}),e.jsx(o,{children:"Discharge Date"}),e.jsx(o,{children:"Diagnosis"}),e.jsx(o,{children:"Treatments"}),e.jsx(o,{children:"Medications"}),e.jsx(o,{children:"Follow-Up"}),e.jsx(o,{children:"Notes"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(X,{children:g.map((t,s)=>e.jsxs(U,{children:[e.jsx(i,{children:t.patientName}),e.jsx(i,{children:t.admissionDate}),e.jsx(i,{children:t.dischargeDate}),e.jsx(i,{children:t.diagnosis}),e.jsx(i,{children:t.treatments}),e.jsx(i,{children:t.medications}),e.jsx(i,{children:t.followUp}),e.jsx(i,{children:t.notes}),e.jsx(i,{children:e.jsx(P,{color:"info",size:"sm",onClick:()=>R(t),children:"Print"})})]},s))})]})]})]})})})};export{de as default};
